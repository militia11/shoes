
DELIMITER //
CREATE TRIGGER sum BEFORE UPDATE
ON zamowienia FOR EACH ROW
BEGIN
DECLARE roznica INT;
DECLARE zamowioneOld INT;
DECLARE nieodebraneOld INT;
SET NEW.suma = NEW.R36 + NEW.R37 + NEW.R38 + NEW.R39+ NEW.R40 + NEW.R41 + NEW.R42+ NEW.R43 + NEW.R44 + NEW.R45 + NEW.R46 + NEW.R47 + NEW.R48 + NEW.R49 + NEW.R50;
SET zamowioneOld := (select zamowione from klienci where klienci.id=NEW.id_klienta);
SET nieodebraneOld := (select nieodebrane from klienci where klienci.id=NEW.id_klienta);
IF OLD.suma < NEW.suma THEN BEGIN
   SET roznica := NEW.suma -OLD.suma;
update klienci set zamowione=zamowioneOld+roznica where id=NEW.id_klienta;
update klienci set nieodebrane=nieodebraneOld+roznica where id=NEW.id_klienta;
  END; 
ELSE
 BEGIN 
SET roznica := OLD.suma - NEW.suma;
update klienci set zamowione=zamowioneOld-roznica where id=NEW.id_klienta;
update klienci set nieodebrane=nieodebraneOld-roznica where id=NEW.id_klienta;
END; END IF;
END;
// DELIMITER ;


#INSERT INTO `obuwie_db`.`modele` (`wzory_id`, `matryce_id`, `ocieplenie`, `kolor`, `wkladka`, `skora_id`, `spody_id`) VALUES (1, 1, 1, 1, 1, 1, 1);


#select * from cena where skora_id=1;
#update skora set aktualna_cena=700 where id+1;


#update modele set zdj2=LOAD_FILE('/home/mmichniewski/001.jpg') where id=1;
#
