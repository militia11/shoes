src/moc_%.cc: src/%.h src/%.cc
	moc $(TEST) $< -o $@

src/test/moc_%.cc: src/test/%.h src/test/%.cc
	moc $(TEST) $< -o $@

DYNFLAGS := -fPIC -shared
QTLIBS = -L../lib -Wl,-rpath=/wb-5.0/system/lib $(shell pkg-config QtCore QtTest QtSql QtGui --libs)

ZSSWLIB := \
			src/CAbstractOnFieldFilter.cc \
			src/CDatabaseConnection.cc \
			src/CDatabaseManager.cc \
			src/CDatabaseTranslator.cc \
			src/CEmptyFilter.cc \
			src/CEqualFilter.cc \
			src/CEventsRepository.cc \
			src/CEventsTypesRepository.cc \
			src/CLogger.cc \
			src/CRangeFilter.cc \
			src/CRepository.cc \
			src/CRepositoryWithAdditionalTable.cc \
			src/moc_CDatabaseConnection.cc \
			src/moc_CEventsRepository.cc \
			src/moc_CRepository.cc

test: libzsswdatabase.so

LDFLAGS += -rdynamic

libzsswdatabase.so: $(ZSSWLIB)
	$(CC) $(CPPFLAGS) $(OPTFLAGS) $(DYNFLAGS) -o $@ $(QTLIBS) $(ZSSWLIB)

clean: cleanZsswLib

cleanZsswLib:
	@$(RM) src/moc_*
	@$(RM) src/test/moc_*
	@$(RM) -r libzsswdatabase.so
